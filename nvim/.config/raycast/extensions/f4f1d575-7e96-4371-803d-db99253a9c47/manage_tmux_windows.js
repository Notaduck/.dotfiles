"use strict";var N=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var q=(n,t)=>{for(var e in t)N(n,e,{get:t[e],enumerable:!0})},L=(n,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of G(t))!O.call(n,i)&&i!==e&&N(n,i,{get:()=>t[i],enumerable:!(o=U(t,i))||o.enumerable});return n};var M=n=>L(N({},"__esModule",{value:!0}),n);var z={};q(z,{default:()=>B});module.exports=M(z);var r=require("@raycast/api"),f=require("react");var W=require("@raycast/api"),k=require("child_process");async function P(n){let e=!!await W.LocalStorage.getItem("terminalAppBundleId");return n(e),e}async function b(){let n=await W.LocalStorage.getItem("terminalAppBundleId");(0,k.execSync)(`open -b ${n}`)}var y=require("child_process");var x=Object.assign({},process.env,{PATH:"/usr/local/bin:/usr/bin:/opt/homebrew/bin"});var c=require("@raycast/api");function $(n){return(0,y.exec)('tmux list-windows -aF "#{session_name}:#{window_name}:#{window_index}"',{env:x},n)}async function F(n,t){let e=await(0,c.showToast)({style:c.Toast.Style.Animated,title:""});t(!0);let{sessionName:o,windowIndex:i,windowName:u}=n;(0,y.exec)(`tmux switch -t ${o}`,{env:x},async(m,g,s)=>{if(m||s){console.error(`exec error: ${m||s}`),e.style=c.Toast.Style.Failure,e.title="No tmux client found \u{1F622}",e.message=m?m.message:s,t(!1);return}(0,y.execSync)(`tmux select-window -t ${i}`,{env:x});try{await b(),e.style=c.Toast.Style.Success,e.title=`Switched to window ${u}`,await(0,c.showHUD)(`Switched to window ${u}`),t(!1)}catch{e.style=c.Toast.Style.Failure,e.title="Terminal not supported \u{1F622}",t(!1)}})}function C(n,t,e,o){return(0,y.exec)(`tmux rename-window -t ${n}:${t} ${e}`,{env:x},o)}async function R(n,t,e){t(!0);let o=await(0,c.showToast)({style:c.Toast.Style.Animated,title:""});(0,y.exec)(`tmux kill-window -t ${n.sessionName}:${n.windowName}`,{env:x},(i,u,m)=>{if(i||m){console.error(`exec error: ${i||m}`),o.style=c.Toast.Style.Failure,o.title="Something went wrong \u{1F622}",o.message=i?i.message:m,t(!1);return}o.style=c.Toast.Style.Success,o.title=`Deleted window ${n.windowName}`,e(),t(!1)})}var a=require("@raycast/api"),v=require("react");var _=require("node:child_process");var E=require("@raycast/api");function D(n,t,e){return(0,_.exec)(`tmux rename-session -t ${n} ${t}`,{env:x},e)}var T=require("react/jsx-runtime"),V=({sessionName:n,windowName:t,type:e,callback:o})=>{let[i,u]=(0,v.useState)(!1),[m,g]=(0,v.useState)(""),{pop:s}=(0,a.useNavigation)();return(0,T.jsx)(a.Form,{isLoading:i,navigationTitle:`Rename Tmux ${e}`,actions:(0,T.jsx)(a.ActionPanel,{children:(0,T.jsx)(a.Action.SubmitForm,{title:`Rename ${e}`,onSubmit:async d=>{let l=d.renamedValue;u(!0);let p=await(0,a.showToast)({style:a.Toast.Style.Animated,title:""});if(l===t&&e==="Window"||l===n&&e==="Session"){p.style=a.Toast.Style.Failure,p.message=`${e} name is not changed`,u(!1);return}let S=(h,I,A)=>{if(h||A){console.error(`exec error: ${h}`),u(!1),p.style=a.Toast.Style.Failure,p.message=`Failed to rename ${e.toLowerCase()}`;return}p.style=a.Toast.Style.Success,p.message=`${e} has been renamed to ${l}`,u(!1),o&&o(),s()};switch(e){case"Session":D(n,l,S);break;case"Window":{if(!t)throw new Error("windowName is required for type Window");C(n,t,l,S);break}default:break}}})}),children:(0,T.jsx)(a.Form.TextField,{title:`Renamed ${e}`,id:"renamedValue",error:m,defaultValue:t,onChange:d=>{!d||d.length===0||d===t||$((l,p,S)=>{(l||S)&&(console.error(`exec error: ${l}`),u(!1)),p.trim().split(`
`).includes(d)?g(`${e} name already exists, you can not rename to`):g("")})}})})};var w=require("react/jsx-runtime");function B(){let[n,t]=(0,f.useState)([]),[e,o]=(0,f.useState)(!0),[i,u]=(0,f.useState)(!1),{push:m}=(0,r.useNavigation)(),g=()=>{$((s,d)=>{if(s){console.error(`exec error: ${s}`),o(!1);return}let l=d.trim().split(`
`);if(l?.length>0){let p=0,S=l.map(h=>{let[I,A,H]=h.split(":");return p+=1,{keyIndex:p,sessionName:I,windowIndex:Number.parseInt(H),windowName:A}});t(S)}o(!1)})};return(0,f.useEffect)(()=>{(async()=>{if(o(!0),!await P(u)){o(!1);return}})()},[]),(0,f.useEffect)(()=>{i&&(o(!0),g())},[i]),(0,f.useEffect)(()=>{e||i||(0,r.launchCommand)({type:r.LaunchType.UserInitiated,name:"choose_terminal_app",extensionName:"tmux-sessioner",ownerOrAuthorName:"louishuyng",context:{launcherCommand:"manage_tmux_windows"}})},[i,e]),(0,w.jsx)(r.List,{isLoading:e,children:n.map((s,d)=>(0,w.jsx)(r.List.Item,{icon:r.Icon.Gear,keywords:[s.sessionName,s.windowName],title:{value:s.windowName,tooltip:`Session: ${s.sessionName} / Window No: ${s.windowIndex}`},accessories:[{text:{value:s.sessionName,color:r.Color.Green}}],actions:(0,w.jsxs)(r.ActionPanel,{children:[(0,w.jsx)(r.Action,{title:"Switch to Selected Window",onAction:()=>F(s,o)}),(0,w.jsx)(r.Action,{title:"Rename this Window",onAction:()=>{m((0,w.jsx)(V,{sessionName:s.sessionName,windowName:s.windowName,type:"Window",callback:()=>g()}))},shortcut:{modifiers:["cmd","opt"],key:"r"}}),(0,w.jsx)(r.Action,{title:"Delete This Window",onAction:()=>R(s,o,()=>t(n.filter(l=>l.keyIndex!==s.keyIndex))),shortcut:{modifiers:["cmd","opt"],key:"x"}})]})},d))})}
