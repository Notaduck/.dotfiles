"use strict";var A=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var q=(t,n)=>{for(var e in n)A(t,e,{get:n[e],enumerable:!0})},L=(t,n,e,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of U(n))!O.call(t,s)&&s!==e&&A(t,s,{get:()=>n[s],enumerable:!(o=H(n,s))||o.enumerable});return t};var z=t=>L(A({},"__esModule",{value:!0}),t);var G={};q(G,{default:()=>_});module.exports=z(G);var i=require("@raycast/api"),x=require("react");var r=require("@raycast/api"),N=require("react");var T=require("child_process");var w=Object.assign({},process.env,{PATH:"/usr/local/bin:/usr/bin:/opt/homebrew/bin"});var v=require("@raycast/api");var E=require("@raycast/api"),P=require("child_process");async function F(t){let e=!!await E.LocalStorage.getItem("terminalAppBundleId");return t(e),e}async function b(){let t=await E.LocalStorage.getItem("terminalAppBundleId");(0,P.execSync)(`open -b ${t}`)}function C(t){return(0,T.exec)('tmux list-windows -aF "#{session_name}:#{window_name}:#{window_index}"',{env:w},t)}function W(t,n,e,o){return(0,T.exec)(`tmux rename-window -t ${t}:${n} ${e}`,{env:w},o)}var y=require("node:child_process");var l=require("@raycast/api");function k(t){return(0,y.exec)("tmux list-sessions | awk '{print $1}' | sed 's/://'",{env:w},t)}function I(t,n,e){return(0,y.exec)(`tmux rename-session -t ${t} ${n}`,{env:w},e)}async function R(t,n){let e=await(0,l.showToast)({style:l.Toast.Style.Animated,title:""});n(!0),(0,y.exec)(`tmux switch -t ${t}`,{env:w},async(o,s,c)=>{if(o||c){console.error(`exec error: ${o||c}`),e.style=l.Toast.Style.Failure,e.title="No tmux client found \u{1F622}",e.message=o?o.message:c,n(!1);return}try{await b(),e.style=l.Toast.Style.Success,e.title=`Switched to session ${t}`,await(0,l.showHUD)(`Switched to session ${t}`),n(!1)}catch{e.style=l.Toast.Style.Failure,e.title="Terminal not supported \u{1F622}",n(!1)}})}async function D(t,n,e){n(!0);let o=await(0,l.showToast)({style:l.Toast.Style.Animated,title:""});(0,y.exec)(`tmux kill-session -t ${t}`,{env:w},(s,c,p)=>{if(s||p){console.error(`exec error: ${s||p}`),o.style=l.Toast.Style.Failure,o.title="Something went wrong \u{1F622}",o.message=s?s.message:p,n(!1);return}o.style=l.Toast.Style.Success,o.title=`Deleted session ${t}`,e(),n(!1)})}var g=require("react/jsx-runtime"),V=({sessionName:t,windowName:n,type:e,callback:o})=>{let[s,c]=(0,N.useState)(!1),[p,S]=(0,N.useState)(""),{pop:u}=(0,r.useNavigation)();return(0,g.jsx)(r.Form,{isLoading:s,navigationTitle:`Rename Tmux ${e}`,actions:(0,g.jsx)(r.ActionPanel,{children:(0,g.jsx)(r.Action.SubmitForm,{title:`Rename ${e}`,onSubmit:async d=>{let a=d.renamedValue;c(!0);let f=await(0,r.showToast)({style:r.Toast.Style.Animated,title:""});if(a===n&&e==="Window"||a===t&&e==="Session"){f.style=r.Toast.Style.Failure,f.message=`${e} name is not changed`,c(!1);return}let h=($,J,B)=>{if($||B){console.error(`exec error: ${$}`),c(!1),f.style=r.Toast.Style.Failure,f.message=`Failed to rename ${e.toLowerCase()}`;return}f.style=r.Toast.Style.Success,f.message=`${e} has been renamed to ${a}`,c(!1),o&&o(),u()};switch(e){case"Session":I(t,a,h);break;case"Window":{if(!n)throw new Error("windowName is required for type Window");W(t,n,a,h);break}default:break}}})}),children:(0,g.jsx)(r.Form.TextField,{title:`Renamed ${e}`,id:"renamedValue",error:p,defaultValue:n,onChange:d=>{!d||d.length===0||d===n||C((a,f,h)=>{(a||h)&&(console.error(`exec error: ${a}`),c(!1)),f.trim().split(`
`).includes(d)?S(`${e} name already exists, you can not rename to`):S("")})}})})};var m=require("react/jsx-runtime");function _(){let[t,n]=(0,x.useState)([]),[e,o]=(0,x.useState)(!0),[s,c]=(0,x.useState)(!1),{push:p}=(0,i.useNavigation)(),S=()=>{k((u,d)=>{if(u){console.error(`exec error: ${u}`),o(!1);return}let a=d.trim().split(`
`);a?.length>0&&n(a),o(!1)})};return(0,x.useEffect)(()=>{(async()=>{if(o(!0),!await F(c)){o(!1);return}})()},[]),(0,x.useEffect)(()=>{s&&(o(!0),S())},[s]),(0,x.useEffect)(()=>{!s&&!e&&(0,i.launchCommand)({type:i.LaunchType.UserInitiated,name:"choose_terminal_app",extensionName:"tmux-sessioner",ownerOrAuthorName:"louishuyng",context:{launcherCommand:"index"}})},[s,e]),(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(i.List,{isLoading:e,children:t.map((u,d)=>(0,m.jsx)(i.List.Item,{icon:i.Icon.Terminal,title:u,actions:(0,m.jsxs)(i.ActionPanel,{children:[(0,m.jsx)(i.Action,{title:"Switch to Selected Session",onAction:()=>R(u,o)}),(0,m.jsx)(i.Action,{title:"Rename this Session",onAction:()=>{p((0,m.jsx)(V,{sessionName:u,windowName:"",type:"Session",callback:()=>S()}))},shortcut:{modifiers:["cmd","opt"],key:"r"}}),(0,m.jsx)(i.Action,{title:"Delete This Session",onAction:()=>D(u,o,()=>n(t.filter(a=>a!==u))),shortcut:{modifiers:["cmd","opt"],key:"x"}})]})},d))})})}
