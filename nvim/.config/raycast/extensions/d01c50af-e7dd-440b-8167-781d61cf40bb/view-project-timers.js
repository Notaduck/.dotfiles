"use strict";var h=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var v=(t,r)=>{for(var o in r)h(t,o,{get:r[o],enumerable:!0})},F=(t,r,o,m)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of j(r))!L.call(t,s)&&s!==o&&h(t,s,{get:()=>r[s],enumerable:!(m=P(r,s))||m.enumerable});return t};var O=t=>F(h({},"__esModule",{value:!0}),t);var V={};v(V,{default:()=>C});module.exports=O(V);var e=require("@raycast/api"),u=require("react");var i=require("@raycast/api"),y=require("fs/promises"),S=require("path");async function D(t){if(t.end!=null&&t.end<=t.start)return null;let r=await d(),o=await x();return!r[t.id]||o===t.id?null:(r[t.id].name=t.name,r[t.id].start=t.start,r[t.id].end=t.end,await i.LocalStorage.setItem("projecttimer.timers",JSON.stringify(r)),t)}async function x(){let t=await i.LocalStorage.getItem("projecttimer.runningTimer");return t||null}async function d(){let t=await i.LocalStorage.getItem("projecttimer.timers");return t?JSON.parse(t):{}}function f(t){return(t.end||new Date().getTime())-t.start}function T(t){if(!t)return"-";let r=Math.floor(t/1e3),o=Math.floor(r/60);return`${Math.floor(o/60).toString().padStart(2,"0")}:${(o%60).toString().padStart(2,"0")}:${(r%60).toString().padStart(2,"0")}`}async function b(t){let r=await d();return delete r[t],await i.LocalStorage.setItem("projecttimer.timers",JSON.stringify(r)),await x()===t&&await i.LocalStorage.removeItem("projecttimer.runningTimer"),r}async function A(){let t=(0,i.getPreferenceValues)().exportDirectory;if(!t){await(0,i.showToast)({title:"Export directory not set",message:"Please set the export directory in the extension preferences",style:i.Toast.Style.Failure,primaryAction:{title:"Open Preferences",onAction:()=>{(0,i.openExtensionPreferences)()}}});return}let r=await(0,i.showToast)(i.Toast.Style.Animated,"Fetching Timers"),o=await d();r.title="Exporting CSV";let m=`id,name,start,end,duration,formatted
`+Object.values(o).map(c=>{let l=f(c);return[...Object.values(c),l,T(l)].join()}).join(`
`),s=(0,S.join)(t,`projecttimer.runningTimer-${new Date().getTime()}.csv`);try{await(0,y.writeFile)(s,m,"utf8"),r.message=s,r.style=i.Toast.Style.Success,r.title="Exported CSV",r.primaryAction={title:"Show in Finder",async onAction(){await(0,i.showInFinder)(s)}}}catch(c){r.style=i.Toast.Style.Failure,r.title="Export failed",r.message=`${c}`}}var a=require("react/jsx-runtime");function U(t){let[r,o]=(0,u.useState)("");return(0,a.jsxs)(e.Form,{actions:(0,a.jsx)(e.ActionPanel,{children:(0,a.jsx)(e.Action.SubmitForm,{title:"Submit",onSubmit:m=>{let s=m["start-date"],c=m["end-date"];if(s>=c)return o("End Date must be after Start Date"),!1;if(c>new Date)return o("End Date must be a date in the past"),!1;t.onUpdate(s,c)}})}),children:[(0,a.jsx)(e.Form.DatePicker,{title:"Start Date",id:"start-date",defaultValue:new Date(t.timer.start),onChange:()=>o("")}),(0,a.jsx)(e.Form.DatePicker,{error:r,title:"End Date",id:"end-date",defaultValue:new Date(t.timer.end),onChange:()=>o("")})]})}function C(){let[t,r]=(0,u.useState)(),[o,m]=(0,u.useState)([]),[s,c]=(0,u.useState)(""),[l,w]=(0,u.useState)(void 0);(0,u.useEffect)(()=>{d().then(g)},[]),(0,u.useEffect)(()=>{t&&m(t.filter(n=>n.name?.toLowerCase().includes(s.toLowerCase())))},[t,s]);function g(n){let p=Object.values(n).sort((I,E)=>E.start-I.start).slice(0,50);r(p),m(p)}return l?(0,a.jsx)(U,{timer:l,onUpdate:async(n,p)=>{await D({...l,start:n.getTime(),end:p.getTime()}),d().then(g),w(void 0)}}):(0,a.jsx)(e.List,{isLoading:t===void 0,searchText:s,searchBarPlaceholder:"Search timers...",onSearchTextChange:n=>c(n),children:o.map(n=>(0,a.jsx)(e.List.Item,{title:n.name??"Unnamed timer",subtitle:n.end?new Date(n.start).toLocaleString()+" - "+new Date(n.end).toLocaleString():new Date(n.start).toLocaleString(),accessories:[{text:(n.end?"\u2705 ":"\u23F3 ")+T(f(n))}],actions:(0,a.jsxs)(e.ActionPanel,{children:[n.end?(0,a.jsx)(e.Action,{icon:e.Icon.Repeat,title:"Start Again",onAction:()=>{(0,e.launchCommand)({name:"start-timer",type:e.LaunchType.UserInitiated,arguments:{name:n.name}})}}):(0,a.jsx)(e.Action,{icon:e.Icon.Stop,title:"Stop Timer",onAction:()=>{(0,e.launchCommand)({name:"stop-timer",type:e.LaunchType.UserInitiated})}}),(0,a.jsx)(e.Action.CopyToClipboard,{icon:e.Icon.CopyClipboard,title:"Copy Duration",content:T(f(n))}),!!n.end&&(0,a.jsx)(e.Action,{icon:e.Icon.EditShape,title:"Edit Timer",shortcut:e.Keyboard.Shortcut.Common.Edit,onAction:()=>w(n)}),(0,a.jsx)(e.Action,{icon:e.Icon.Trash,title:"Delete Timer",shortcut:e.Keyboard.Shortcut.Common.Remove,onAction:async()=>{await(0,e.confirmAlert)({title:"Are you sure you want to delete this timer?",message:"This action cannot be undone.",icon:{source:e.Icon.Trash,tintColor:e.Color.Red},primaryAction:{style:e.Alert.ActionStyle.Default,title:"Delete timer"},rememberUserChoice:!0})&&(b(n.id).then(g),await(0,e.showToast)({title:"Timer with duration "+T(f(n))+" deleted"}))},style:e.Action.Style.Destructive}),(0,a.jsx)(e.Action,{icon:e.Icon.Download,title:"Export Timers as CSV",shortcut:{modifiers:["cmd"],key:"s"},onAction:A})]})},n.id))})}
